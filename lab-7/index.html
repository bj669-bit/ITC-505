<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lab 7: Mad Lib</title>
</head>
<body>
    <h1>Mad Lib Form</h1>
    <form id="madLibForm">
        <label for="adjective">Adjective:</label>
        <input type="text" id="adjective" name="adjective" required><br><br>

        <label for="noun">Noun:</label>
        <input type="text" id="noun" name="noun" required><br><br>

        <label for="verb">Verb:</label>
        <input type="text" id="verb" name="verb" required><br><br>

        <label for="place">Place:</label>
        <input type="text" id="place" name="place" required><br><br>

        <label for="pluralNoun">Plural Noun:</label>
        <input type="text" id="pluralNoun" name="pluralNoun" required><br><br>

        <button type="submit">Create Mad Lib</button>
    </form>

    <h2>Result:</h2>
    <p id="story"></p>
    <p id="randomNumber"></p>

    <!-- Footer -->
    <footer>
        <p>Last updated: <span id="lastModified"></span></p>
    </footer>
    <script type="text/javascript">
        // Footer script
        var x = document.lastModified;
        document.getElementById('lastModified').textContent = x;

        const form = document.getElementById('madLibForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // prevent page reload

            // Collect form data
            const formData = {
                adjective: document.getElementById('adjective').value,
                noun: document.getElementById('noun').value,
                verb: document.getElementById('verb').value,
                place: document.getElementById('place').value,
                pluralNoun: document.getElementById('pluralNoun').value
            };

            try {
                // Send POST request to server
                const response = await fetch('/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                const data = await response.json();

                if (data.error) {
                    document.getElementById('story').textContent = data.error;
                    document.getElementById('randomNumber').textContent = '';
                    return;
                }

                // Fetch a random number
                const randRes = await fetch('/do_a_random');
                const randData = await randRes.json();

                // Display Mad Lib and random number
                document.getElementById('story').textContent = data.madLib;
                document.getElementById('randomNumber').textContent = `Your random number is: ${randData.addednum}`;

            } catch (err) {
                console.error(err);
            }
        });
    </script>
</body>
</html>
